<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>Public Records Request Assistant</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css" rel="stylesheet">
  
  <style>
    
    body {
      margin-top:45px;
      margin-bottom:45px;
    }
    
  </style>
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

</head>
 
<body>
 
 <div class="container">
   
   <div class="row">
     
     <div class="col-md-8 offset-md-2">
   
     <h1 class="display-6">Public Records Request Assistant</h1>
     <hr>
     
  <form>
  
  <div class="mb-3">
    <label for="select" class="form-label text-muted">Town and Department</label>
    <select id="select" class="form-select form-control-sm" onchange="constructBoilerplate();">
      <option selected>Choose a town and department</option>
    </select>
  </div>
    
  <div class="mb-3">
    <label for="to" class="form-label text-muted">To</label>
    <input type="email" class="form-control form-control-sm" id="to" value="" oninput="constructMailto();">
  </div>
     
  <div class="mb-3">
    <label for="subject" class="form-label text-muted">Subject</label>
    <input type="email" class="form-control form-control-sm" id="subject" value="" oninput="constructMailto();">
  </div>

  <div class="mb-3">
    <label for="salutation" class="form-label text-muted">Salutation</label>
      <textarea class="form-control form-control-sm" id="salutation" rows="3" oninput="constructMailto();"></textarea>
  </div>
    
  <div class="mb-3">
    <label for="request" class="form-label text-muted">Request Body</label>
      <textarea class="form-control form-control-sm" id="request" rows="6" oninput="constructMailto();"></textarea>
  </div>

  <div class="mb-3">
    <label for="closing" class="form-label text-muted">Closing</label>
      <textarea class="form-control form-control-sm" id="outro" rows="3" oninput="constructMailto();"></textarea>
  </div>
  
  <div class="d-grid gap-2">
    <a id="submitButton" href="" class="btn btn-primary">Submit</a>
  </div>
    
  </form>
       
     </div><!-- column -->
   </div><!-- row -->
 </div><!-- container -->
  
 <script>
   
   function constructSelect(data){
     
     var select = document.getElementById('select');
     data.forEach(
       (entry,index) => {
         option = document.createElement("option");
         option.text = entry.town + " " + entry.organization;
         option.value = index;
         select.add(option);
       }
     );
     
   };
   
   function constructBoilerplate(){
     
     entryNumber = document.getElementById("select").value;
     let today = new Date().toLocaleDateString()
     document.getElementById("to").value = formData[0][entryNumber].email;
     document.getElementById("salutation").value = formData[0][entryNumber].short_name + ", I believe you are the right person to address this email to, but if I am wrong please forward to the appropriate Public Records Officer for the {organization}.\r\n\r\n I am writing with a request under the Massachusetts Public Records Law (M. G. L. Chapter 66, Section 10). I am requesting that I be provide a copy of the following records:";
     document.getElementById("subject").value = "Public Records Request " + today;
     document.getElementById("closing").value = "I recognize that you may charge reasonable costs for copies, as well as for personnel time needed to comply with this request. I am fine with receiving either hard copies or .pdf versions of the requested information, although for accessibilty reasons the original form of the document (text, csv, excel) is always preferable./r/n/r/nThe Public Records Law requires you to provide me with a written response within 10 business days. If you cannot comply with my request, you are statutorily required to provide an explanation in writing.\r\n\r\nSincerely,";
     constructMailto();
     
   };
                                                               
   function constructMailto(){ 

     to = document.getElementById("to").value;
     subject = encodeURIComponent(document.getElementById("subject").value);
     intro = document.getElementById("salutation").value;
     request = document.getElementById("request").value;
     outro = document.getElementById("closing").value;
     body = encodeURIComponent(intro + "\r\n\r\n" + request + "\r\n\r\n" + outro);
     mailtoString = "mailto:" + to + "?subject=" + subject + "&body=" + body;
     
     var mailto = document.getElementById("submitButton");
     mailto.href = mailtoString;
     //console.log(mailtoString);
     
   };
   
   let formData = [];
   fetch('/data.json')
    .then(response => response.json())
    .then(data => {
     formData.push(data);
     //console.log(data);
     constructSelect(data);
   });
   
   //console.log(formData);
  </script>
                                                                         
 </body>
 
</html>
