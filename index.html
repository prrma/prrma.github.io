<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>Public Records Request Assistant</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css" rel="stylesheet">
  
  <style>
    
    body {
      margin-top: 1rem;
      margin-bottom: 3rem;
    }
    
    #salutation, #request, #closing {
      min-height: 13rem;
    }
    
  </style>
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  
</head>
 
<body>
 
 <div class="container">
   
   <div class="row">
     
     <div class="col-md-8 offset-md-2">
   
     <h1 class="display-6"><i class="bi bi-envelope-check"></i> Public Records Request Assistant</h1>
     <hr>
     
      <form>

      <div class="form-floating mb-3">
        <input type="text" class="form-control" id="subject" value="" placeholder=" " oninput="constructMailto();">
        <label for="subject" class="form-label text-muted">Subject</label>
      </div>

      <div class="form-floating mb-3">
        <textarea class="form-control form-control-sm" id="salutation" rows="7" placeholder=" " oninput="constructMailto();"></textarea>
        <label for="salutation" class="form-label text-muted">Salutation</label>
      </div>

      <div class="form-floating mb-3">
        <textarea class="form-control form-control-sm" id="request" rows="8" placeholder="(Put the nature of your request here)" oninput="constructMailto();" title="Step 2" data-bs-toggle="popover" data-bs-trigger="focus" data-bs-placement="right" data-bs-content="Place the text of your request in this field."></textarea>
        <label for="request" class="form-label text-muted">Request Body</label>
      </div>

      <div class="form-floating mb-3">
        <textarea class="form-control form-control-sm" id="closing" rows="10" placeholder=" " oninput="constructMailto();"></textarea>
        <label for="closing" class="form-label text-muted">Closing</label>
      </div>

      <div class="form-floating mb-3">
        <textarea class="form-control form-control-sm" id="name" rows="3" placeholder="(Put your name here)" oninput="constructMailto();" title="Step 3" data-bs-toggle="popover" data-bs-trigger="focus" data-bs-placement="right" data-bs-content="Put your name here."></textarea>
        <label for="name" class="form-label text-muted">Your Name</label>
      </div>
        
      <div class="form-floating mb-3">
        <textarea class="form-control form-control-sm" id="email" rows="3" placeholder="(Put your email here)" oninput="constructMailto();" title="Step 4" data-bs-toggle="popover" data-bs-trigger="focus" data-bs-placement="right" data-bs-content="Put your email address here."></textarea>
        <label for="name" class="form-label text-muted">Your Email</label>
      </div>

      <div class="d-grid gap-2">
        <a id="submitButton" onclick="" href="" class="btn btn-primary" title="Step 4" data-bs-toggle="popover" data-bs-trigger="focus" data-bs-placement="right" data-bs-content="Send the email via your email client.">Compose email <i class="bi bi-send-check"></i></a>
      </div>

      </form>
       
     </div><!-- column -->
   </div><!-- row -->
 </div><!-- container -->
  
 <script>
      
   function constructBoilerplate(){
     
     entryNumber = document.getElementById("select").value;
     let today = new Date().toLocaleDateString()
     document.getElementById("salutation").value = formData[entryNumber].salutation + ",\r\n\r\nI believe you are the right person to address this email to, but if I am wrong please forward to the appropriate Public Records Officer for the " + formData[entryNumber].town + " " + formData[entryNumber].organization + ".\r\n\r\nI am writing with a request under the Massachusetts Public Records Law (M. G. L. Chapter 66, Section 10). The Public Records Law requires you to provide me with a written response within 10 business days. If you cannot comply with my request, you are statutorily required to provide an explanation in writing. I am requesting that I be provided a copy of the following records:";
     document.getElementById("subject").value = "Public Records Request " + today;
     document.getElementById("closing").value = "I recognize that you may charge reasonable costs for copies, as well as for personnel time needed to comply with this request. I am fine with receiving either hard copies or digital versions of the requested information, although for accessibility reasons the original digital form of the documentation (text, csv, excel, etc.) is always preferable.\r\n\r\nThank you for your time and attention to this matter.\r\n\r\nSincerely,";
     constructMailto();
     
   };
                                                               
   function constructMailto(){
     
     bcc = '';
     for (const record in contactData.data) {
       bcc = bcc + contactData.data.record[2] + ',';
     };
     email = document.getElementById("email").value;
     subject = encodeURIComponent(document.getElementById("subject").value);
     salutation = document.getElementById("salutation").value;
     request = document.getElementById("request").value;
     closing = document.getElementById("closing").value;
     name = document.getElementById("name").value;
     body = encodeURIComponent(salutation + "\r\n\r\n" + request + "\r\n\r\n" + closing + "\r\n\r\n" + name);
     mailtoString = "mailto:" + email + "?subject=" + subject + "&body=" + body + "&bcc=" + bcc ;
     var mailto = document.getElementById("submitButton");
     mailto.href = mailtoString;
     console.log(mailtoString);
     
   };
   
   
   // pull contact data from Google Doc
   var contactData;
   url = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT_9wwBuJszcT-Evgh-fDZRGU_GLq4oJQai9t8nIKSPM9ZOxLIDsFKTiblYAtgE1NIo4ebrryuskkdi/pub?gid=0&single=true&output=csv'
   Papa.parse(url, {
     download: true,
     header: false,
     complete: function(results){
       console.log(results);
       contactData = results.data;
     }
   });
   
  </script>
                                                                         
 </body>
 
</html>
