<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>Public Records Request Assistant</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css" rel="stylesheet">
  
  <style>
    
    body {
      margin-top:45px;
    }
    
  </style>
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

</head>
 
<body>
 
 <div class="container">
   
   <div class="row">
     
     <div class="col-md-6 offset-md-3">
   
     <h1 class="display-6">Public Records Request Assistant</h1>
     <hr>
     
  <form>
  
  <div class="mb-3">
    <label for="select" class="form-label text-muted">Town and Department</label>
    <select id="select" class="form-select" onchange="constructBoilerplate();"></select>
  </div>
    
  <div class="mb-3">
    <label for="to" class="form-label text-muted">To</label>
    <input type="email" class="form-control" id="to" value="" oninput="constructMailto();">
  </div>
     
  <div class="mb-3">
    <label for="subject" class="form-label text-muted">Subject</label>
    <input type="email" class="form-control" id="subject" value="Public Records Request" oninput="constructMailto();">
  </div>

  <div class="mb-3">
    <label for="intro" class="form-label text-muted">Intro</label>
      <textarea class="form-control" id="intro" rows="3" oninput="constructMailto();"></textarea>
  </div>
    
  <div class="mb-3">
    <label for="request" class="form-label text-muted">Request Body</label>
      <textarea class="form-control" id="request" rows="6" oninput="constructMailto();">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus luctus nisl quis eros vulputate venenatis. Morbi aliquam velit maximus est faucibus maximus. Curabitur bibendum sit amet lorem eu auctor. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos.</textarea>
  </div>

  <div class="mb-3">
    <label for="outro" class="form-label text-muted">Outro</label>
      <textarea class="form-control" id="outro" rows="3" oninput="constructMailto();"></textarea>
  </div>
    
  <a id="submitButton" href="mailto:jeffehobbs@gmail.com" class="btn btn-primary btn-block">Submit</a>
     
  </form>
       
     </div><!-- column -->
   </div><!-- row -->
 </div><!-- container -->
  
 <script>
   
   function constructSelect(data){
     
     var select = document.getElementById('select');
     data.forEach(
       (entry,index) => {
         option = document.createElement("option");
         option.text = entry.town + " " + entry.organization;
         option.value = index;
         select.add(option);
       }
     );
     
   };
   
   function constructBoilerplate(){
     
     entryNumber = document.getElementById("select").value;
     document.getElementById("to").value = formData[0][entryNumber].email;
     document.getElementById("intro").value = "Hello " + formData[0][entryNumber].short_name + ",";
     document.getElementById("subject").value = "Public Records Request " + Date().toLocaleDateString();
     document.getElementById("outro").value = "Sincerely,";
     constructMailto();
     
   };
                                                               
   function constructMailto(){ 

     to = document.getElementById("to").value;
     subject = encodeURIComponent(document.getElementById("subject").value);
     intro = document.getElementById("intro").value;
     request = document.getElementById("request").value;
     outro = document.getElementById("outro").value;
     body = encodeURIComponent(intro + "\r\n\r\n" + request + "\r\n\r\n" + outro);
     mailtoString = "mailto:" + to + "?subject=" + subject + "&body=" + body;
     
     var mailto = document.getElementById("submitButton");
     mailto.href = mailtoString;
     //console.log(mailtoString);
     
   };
   
   let formData = [];
   fetch('/data.json')
    .then(response => response.json())
    .then(data => {
     formData.push(data);
     //console.log(data);
     constructSelect(data);
   });
   
   //console.log(formData);
  </script>
                                                                         
 </body>
 
</html>
